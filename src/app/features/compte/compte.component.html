<div class="min-h-screen py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <!-- Titre de la page  -->
        <h1 class="text-3xl font-bold text-gray-900 mb-8">Mon compte</h1>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <!-- Carte du profil utilisateur (gauche) -->
            <div class="lg:col-span-4">
                <div class="bg-white rounded-lg shadow-sm p-8">
                    <!-- Photo de profil ou initiales -->
                    <div class="flex justify-center mb-6">
                        <div class="relative">
                            @if (hasUserPhoto()) {
                            <img [src]="getUserPhotoUrl()" alt="Photo de profil"
                                class="w-32 h-32 rounded-full object-cover border-4 border-[#ff5c01]" />
                            } @else {
                            <div class="w-32 h-32 rounded-full bg-[#ff5c01] flex items-center justify-center">
                                <span class="text-white text-5xl font-bold">{{ getUserInitials() }}</span>
                            </div>
                            }

                            <!-- Icône de caméra -->
                            <button type="button"
                                class="absolute bottom-0 right-0 bg-gray-600 hover:bg-gray-700 text-white rounded-full p-2 shadow-lg transition-colors"
                                title="Changer la photo">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z">
                                    </path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Nom et profil -->
                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-gray-900 mb-1">
                            {{ getUserFullName() }}
                        </h2>
                        <p class="text-gray-600 text-sm">{{ getUserProfile() }}</p>
                    </div>
                </div>
            </div>

            <!-- Contenu principal (droite) -->
            <div class="lg:col-span-8">
                <div class="bg-white rounded-lg shadow-sm">
                    <!-- Onglets -->
                    <div class="border-b border-gray-200 px-8 pt-6">
                        <nav class="flex space-x-8" aria-label="Tabs">
                            <button type="button" (click)="setActiveTab('informations')" [class]="activeTab() === 'informations' 
            ? 'border-[#ff5c01] text-[#ff5c01] font-medium' 
            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-1 border-b-2 text-sm transition-colors">
                                Informations personnelles
                            </button>

                            @if (!isAdmin()) {
                            <button type="button" (click)="setActiveTab('abonnements')" [class]="activeTab() === 'abonnements' 
            ? 'border-[#ff5c01] text-[#ff5c01] font-medium' 
            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-1 border-b-2 text-sm transition-colors">
                                Abonnements
                            </button>
                            <button type="button" (click)="setActiveTab('factures')" [class]="activeTab() === 'factures' 
            ? 'border-[#ff5c01] text-[#ff5c01] font-medium' 
            : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                class="py-4 px-1 border-b-2 text-sm transition-colors">
                                Factures
                            </button>
                            }
                        </nav>
                    </div>

                    <!-- Contenu de l'onglet -->
                    <div class="p-8">
                        @if (activeTab() === 'informations') {
                        <!-- Formulaire d'informations personnelles -->
                        <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Prénom -->
                                <div>
                                    <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">
                                        Prénom
                                    </label>
                                    <input type="text" id="prenom" formControlName="prenom"
                                        [class.border-red-500]="isFieldInvalid('prenom')"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent transition-colors"
                                        placeholder="Cheikh" />
                                    @if (isFieldInvalid('prenom')) {
                                    <p class="mt-1 text-sm text-red-600">{{ getFieldError('prenom') }}</p>
                                    }
                                </div>

                                <!-- Nom -->
                                <div>
                                    <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">
                                        Nom
                                    </label>
                                    <input type="text" id="nom" formControlName="nom"
                                        [class.border-red-500]="isFieldInvalid('nom')"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent transition-colors"
                                        placeholder="Gueye" />
                                    @if (isFieldInvalid('nom')) {
                                    <p class="mt-1 text-sm text-red-600">{{ getFieldError('nom') }}</p>
                                    }
                                </div>

                                <!-- Numéro de téléphone -->
                                <div>
                                    <label for="telephone" class="block text-sm font-medium text-gray-700 mb-2">
                                        Numéro de téléphone
                                    </label>
                                    <input type="tel" id="telephone" formControlName="telephone"
                                        [class.border-red-500]="isFieldInvalid('telephone')"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent transition-colors"
                                        placeholder="78 183 73 70" />
                                    @if (isFieldInvalid('telephone')) {
                                    <p class="mt-1 text-sm text-red-600">{{ getFieldError('telephone') }}</p>
                                    }
                                </div>

                                <!-- Email -->
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                                        Email
                                    </label>
                                    <input type="email" id="email" formControlName="email"
                                        [class.border-red-500]="isFieldInvalid('email')"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent transition-colors"
                                        placeholder="cgueye@gmail.com" />
                                    @if (isFieldInvalid('email')) {
                                    <p class="mt-1 text-sm text-red-600">{{ getFieldError('email') }}</p>
                                    }
                                </div>

                                <!-- Nom de l'entreprise -->
                                <div>
                                    <label for="company" class="block text-sm font-medium text-gray-700 mb-2">
                                        Nom de l'entreprise
                                    </label>
                                    <input type="text" id="company" formControlName="company"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent transition-colors"
                                        placeholder="Entreprise A" />
                                </div>

                                <!-- Profil (lecture seule) -->
                                <div>
                                    <label for="profil" class="block text-sm font-medium text-gray-700 mb-2">
                                        Profil
                                    </label>
                                    <input type="text" id="profil" [value]="getUserProfile()" readonly
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-50 text-gray-600 cursor-not-allowed" />
                                </div>
                            </div>

                            <!-- Boutons d'action -->
                            <div class="flex items-center justify-end gap-4 mt-8">
                                <button type="button" (click)="onCancel()" [disabled]="isSaving()"
                                    class="px-6 py-3 text-gray-700 font-medium hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    Annuler
                                </button>
                                <button type="submit" [disabled]="userForm.invalid || isSaving()"
                                    class="px-8 py-3 bg-[#ff5c01] hover:bg-[#e54f00] text-white font-medium rounded-lg shadow-sm transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                                    @if (isSaving()) {
                                    <svg class="animate-spin h-5 w-5 text-white" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                            stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor"
                                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                        </path>
                                    </svg>
                                    <span>Enregistrement...</span>
                                    } @else {
                                    <span>Mettre à jour</span>
                                    }
                                </button>
                            </div>
                        </form>
                        }
                        @if (activeTab() === 'abonnements') {
                        <div>
                            @if (isCheckingSubscription()) {
                            <!-- Chargement de la vérification -->
                            <div class="flex justify-center items-center py-12">
                                <svg class="animate-spin h-8 w-8 text-[#ff5c01]" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                            </div>
                            } @else {
                            @if (hasActiveSubscription()) {
                            <!-- Affichage de l'abonnement en cours -->
                            <div class="space-y-6">
                                <!-- En-tête avec badge actif -->
                                <div class="bg-gradient-to-r bg-gray-100 rounded-xl p-6 text-white">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-4">
                                            <div
                                                class="w-16 h-16 bg-[#ff5c01] rounded-full flex items-center justify-center">
                                                <svg width="28" height="28" viewBox="0 0 24 24" fill="white"
                                                    xmlns="http://www.w3.org/2000/svg">
                                                    <path
                                                        d="M19.0006 18.8823H5.00003C4.44773 18.8823 4 19.3564 4 19.9412C4 20.526 4.44773 21 5.00003 21H19.0006C19.5529 21 20.0006 20.526 20.0006 19.9412C20.0006 19.3564 19.5529 18.8823 19.0006 18.8823Z" />
                                                    <path
                                                        d="M20.9938 6.29224L19.9957 15.8221C19.9382 16.3588 19.511 16.7641 18.9998 16.7641H5.00012C4.49112 16.7641 4.06179 16.3588 4.00647 15.8221L3.00617 6.29224C2.9619 5.8728 3.15887 5.46508 3.5041 5.25653C3.85155 5.04798 4.28088 5.0761 4.59956 5.32917L7.82618 7.89032L11.2188 3.39601C11.4091 3.14528 11.6968 3 12 3C12.3054 3 12.5909 3.14528 12.7812 3.39601L16.176 7.89032L19.4004 5.32917C19.7191 5.0761 20.1506 5.04798 20.4959 5.25653C20.8433 5.46508 21.038 5.8728 20.9938 6.29224Z" />
                                                </svg>
                                            </div>

                                            <div>
                                                <h3 class="text-xl font-bold  text-black/90 ">Mon abonnement</h3>
                                                <p class="text-black/60 mt-1">Date d'expiration : {{ getExpirationDate()
                                                    }}</p>
                                            </div>

                                        </div>

                                        <span
                                            class="bg-gray-200 text-green-500 px-4 py-2 rounded-full text-sm font-semibold">
                                            Actif
                                        </span>
                                    </div>
                                </div>
                                <!-- Alerte pour expiration imminente -->
                                <div *ngIf="getDaysRemaining() <= 7 && getDaysRemaining() > 0"
                                    class="bg-gradient-to-r from-red-50 to-orange-50 border-l-4 border-red-500 p-4 mb-4 rounded-r-lg">
                                    <div class="flex items-start">
                                        <div class="flex-shrink-0">
                                            <svg class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </div>
                                        <div class="ml-3 flex-1">
                                            <h3 class="text-sm font-medium text-red-800">Abonnement bientôt expiré</h3>
                                            <p class="mt-1 text-sm text-red-700">
                                                Votre abonnement expire dans {{ getDaysRemaining() }} jour{{
                                                getDaysRemaining() > 1 ? 's' : '' }}.
                                                <a href="/renouveler"
                                                    class="font-semibold underline hover:text-red-900">
                                                    Renouveler maintenant
                                                </a>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Détails de l'abonnement -->
                                <div class="bg-white border-2 border-gray-100 rounded-xl p-8">
                                    <h4 class="text-xl font-bold text-gray-900 mb-6">Détail de l'abonnement</h4>

                                    <div class="space-y-4">
                                        <!-- Nom du plan -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Nom du plan</span>
                                            <span class="text-gray-900 font-semibold">{{ getCurrentPlanName() }}</span>
                                        </div>

                                        <!-- Sous-titre -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Sous-titre</span>
                                            <span class="text-gray-900 font-bold">{{ getCurrentPlanLabel() }}</span>
                                        </div>

                                        <!-- Statut paiement -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Statut paiement</span>
                                            <span class="inline-flex items-center gap-2">
                                                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                                                <span class="text-green-600 font-semibold">Payé</span>
                                            </span>
                                        </div>

                                        <!-- Période -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Période</span>
                                            <span class="text-gray-900 font-medium">{{ getSubscriptionPeriod() }}</span>
                                        </div>

                                        <!-- Montant payé -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Montant payé</span>
                                            <span class="text-gray-900 font-bold text-lg">{{ getCurrentPlanAmount()
                                                }}</span>
                                        </div>

                                        <!-- Mode de paiement -->
                                        <div class="flex justify-between items-center py-3 border-b border-gray-100">
                                            <span class="text-gray-600">Mode de paiement</span>
                                            <span class="text-gray-900 font-medium">{{ getPaymentMethod() }}</span>
                                        </div>
                                    </div>

                                    <!-- Avantages -->
                                    <div class="mt-8 p-6 bg-gray-50 rounded-lg">
                                        <h5 class="font-semibold text-gray-900 mb-4">Avantages inclus :</h5>
                                        <ul class="space-y-3">
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-[#ff5c01] mt-0.5 flex-shrink-0"
                                                    fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                <span class="text-gray-700">
                                                    @if (isUnlimitedProjects()) {
                                                    Projets illimités
                                                    } @else {
                                                    {{ getProjectLimit() }} projet{{ getProjectLimit() > 1 ? 's' : '' }}
                                                    maximum
                                                    }
                                                </span>
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-[#ff5c01] mt-0.5 flex-shrink-0"
                                                    fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                <span class="text-gray-700">MOA, BET, Chef & Ouvrier</span>
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-[#ff5c01] mt-0.5 flex-shrink-0"
                                                    fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                                <span class="text-gray-700">Support prioritaire</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            } @else {
                            <!-- Affichage des plans disponibles -->
                            @if (isLoadingPlans()) {
                            <div class="flex justify-center items-center py-12">
                                <svg class="animate-spin h-8 w-8 text-[#ff5c01]" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                        stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor"
                                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                    </path>
                                </svg>
                            </div>
                            } @else {
                            <!-- Sélecteur de période -->
                            <div class="flex items-center justify-center gap-4 mb-8">

                                <!-- Label Mensuel -->
                                <span class="text-sm font-medium text-gray-700"
                                    [class.text-gray-900]="!isYearlyBilling()">
                                    Mensuel
                                </span>

                                <!-- TOGGLE SIMPLIFIÉ AVEC SLIDER -->
                                <button type="button" (click)="toggleBillingPeriod()"
                                    class="relative w-14 h-7 rounded-full transition-colors duration-300"
                                    [ngClass]="isYearlyBilling() ? 'bg-orange-500' : 'bg-gray-200'">

                                    <div class="absolute top-1 left-1 w-5 h-5 bg-white rounded-full shadow transition-transform duration-300"
                                        [class.translate-x-7]="isYearlyBilling()">
                                    </div>
                                </button>

                                <!-- Label Annuel + Remise -->
                                <span class="text-sm font-medium text-gray-700 flex items-center gap-2"
                                    [class.text-gray-900]="isYearlyBilling()">

                                    Annuel

                                    @if (basicPlan() && basicPlan()!.yearlyDiscountRate > 0) {
                                    <span
                                        class="px-2 py-0.5 bg-orange-100 text-orange-600 text-xs font-semibold rounded">
                                        -{{ basicPlan()!.yearlyDiscountRate }}%
                                    </span>
                                    }
                                </span>
                            </div>

                            <!-- Cartes d'abonnement -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-4xl mx-auto">
                                <!-- Carte Basic -->
                                @if (basicPlan()) {
                                <div
                                    class="relative border-2 border-[#ff5c01] bg-white rounded-2xl shadow-lg overflow-hidden">
                                    <div class="p-8">
                                        <div class="text-center mb-6">
                                            <h3 class="text-2xl font-bold text-gray-900 mb-2">
                                                {{ getPlanLabel(basicPlan()!) }}
                                            </h3>
                                            <div class="flex items-baseline justify-center gap-1 mb-4">
                                                <span class="text-3xl font-bold text-gray-900">
                                                    {{ formatPrice(basicPlan()!) }}
                                                </span>
                                                <span class="text-gray-600">FCFA</span>
                                                <span class="text-gray-500 text-sm">/ {{ isYearlyBilling() ? 'mois
                                                    (annuel)' : 'mois' }}</span>
                                            </div>

                                            @if (isYearlyBilling() && basicPlan()!.yearlyDiscountRate > 0) {
                                            <div class="text-sm text-gray-500">
                                                <span class="line-through">{{ (basicPlan()!.totalCost *
                                                    12).toLocaleString('fr-FR') }} FCFA/an</span>
                                                <span class="ml-2 text-green-600 font-semibold">
                                                    Économisez {{ basicPlan()!.yearlyDiscountRate }}%
                                                </span>
                                            </div>
                                            }
                                        </div>

                                        <div class="mb-6">
                                            <p class="text-gray-700 text-sm text-center">
                                                {{ getPlanDescription(basicPlan()!) }}
                                            </p>
                                        </div>

                                        <ul class="space-y-4 mb-8">
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="text-gray-700">
                                                    @if (basicPlan()!.unlimitedProjects) {
                                                    Projets illimités
                                                    } @else {
                                                    {{ basicPlan()!.projectLimit }} projet{{ basicPlan()!.projectLimit >
                                                    1 ? 's' : '' }} maximum
                                                    }
                                                </span>
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="text-gray-700">
                                                    Paiement en {{ basicPlan()!.installmentCount }} fois
                                                </span>
                                            </li>
                                            @if (basicPlan()!.yearlyDiscountRate > 0) {
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5 text-green-500 mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="text-gray-700">
                                                    {{ basicPlan()!.yearlyDiscountRate }}% de réduction en paiement
                                                    annuel
                                                </span>
                                            </li>
                                            }
                                        </ul>

                                        <button (click)="subscribeToPlan('Basic')" [disabled]="isProcessingBasic()"
                                            [class.opacity-50]="isProcessingBasic()"
                                            [class.cursor-not-allowed]="isProcessingBasic()"
                                            class="w-full py-3 border-2 border-[#ff5c01] text-[#ff5c01] font-semibold rounded-full hover:bg-[#ff5c01] hover:text-white transition-colors flex items-center justify-center gap-2">
                                            @if (isProcessingBasic()) {
                                            <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                    stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor"
                                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                                </path>
                                            </svg>
                                            <span>Traitement...</span>
                                            } @else {
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                                                </path>
                                            </svg>
                                            <span>Souscrire</span>
                                            }
                                        </button>
                                    </div>
                                </div>
                                } @else {
                                <div class="flex items-center justify-center p-8 bg-gray-50 rounded-2xl">
                                    <p class="text-gray-500">Plan Basic non disponible</p>
                                </div>
                                }

                                <!-- Carte Premium -->
                                @if (premiumPlan()) {
                                <div class="relative bg-gradient-to-br shadow rounded-2xl shadow-lg overflow-hidden">
                                    <div
                                        class="absolute top-4 right-4 bg-[#ff5c01] text-white text-xs font-bold px-3 py-1 rounded-full">
                                        POPULAIRE
                                    </div>

                                    <div class="p-8">
                                        <div class="text-center mb-6">
                                            <h3 class="text-2xl font-bold mb-2">
                                                {{ getPlanLabel(premiumPlan()!) }}
                                            </h3>
                                            <div class="flex items-baseline justify-center gap-1 mb-4">
                                                <span class="text-3xl font-bold">
                                                    {{ formatPrice(premiumPlan()!) }}
                                                </span>
                                                <span class="">FCFA</span>
                                                <span class=" text-sm">/ {{ isYearlyBilling() ? 'mois (annuel)' : 'mois'
                                                    }}</span>
                                            </div>

                                            @if (isYearlyBilling() && premiumPlan()!.yearlyDiscountRate > 0) {
                                            <div class="text-sm ">
                                                <span class="line-through">{{ (premiumPlan()!.totalCost *
                                                    12).toLocaleString('fr-FR') }} FCFA/an</span>
                                                <span class="ml-2  font-semibold">
                                                    Économisez {{ premiumPlan()!.yearlyDiscountRate }}%
                                                </span>
                                            </div>
                                            }
                                        </div>

                                        <div class="mb-6">
                                            <p class=" text-sm text-center">
                                                {{ getPlanDescription(premiumPlan()!) }}
                                            </p>
                                        </div>

                                        <ul class="space-y-4 mb-8">
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5  mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="text-black">
                                                    @if (premiumPlan()!.unlimitedProjects) {
                                                    Projets illimités
                                                    } @else {
                                                    {{ premiumPlan()!.projectLimit }} projet{{
                                                    premiumPlan()!.projectLimit
                                                    > 1 ? 's' : '' }} maximum
                                                    }
                                                </span>
                                            </li>
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5  mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="">
                                                    Paiement en {{ premiumPlan()!.installmentCount }} fois
                                                </span>
                                            </li>
                                            @if (premiumPlan()!.yearlyDiscountRate > 0) {
                                            <li class="flex items-start gap-3">
                                                <svg class="w-5 h-5  mt-0.5 flex-shrink-0" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M5 13l4 4L19 7"></path>
                                                </svg>
                                                <span class="">
                                                    {{ premiumPlan()!.yearlyDiscountRate }}% de réduction en paiement
                                                    annuel
                                                </span>
                                            </li>
                                            }
                                        </ul>

                                        <button (click)="subscribeToPlan('Premium')" [disabled]="isProcessingPremium()"
                                            [class.opacity-50]="isProcessingPremium()"
                                            [class.cursor-not-allowed]="isProcessingPremium()"
                                            class="w-full py-3 bg-[#ff5c01] text-white font-semibold rounded-full transition-colors flex items-center justify-center gap-2">
                                            @if (isProcessingPremium()) {
                                            <svg class="animate-spin h-5 w-5" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor"
                                                    stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor"
                                                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                                                </path>
                                            </svg>
                                            <span>Traitement...</span>
                                            } @else {
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                                                </path>
                                            </svg>
                                            <span>Passer à Premium</span>
                                            }
                                        </button>
                                    </div>
                                </div>
                                } @else {
                                <div class="flex items-center justify-center p-8 bg-gray-50 rounded-2xl">
                                    <p class="text-gray-500">Plan Premium non disponible</p>
                                </div>
                                }
                            </div>
                            }
                            }
                            }
                        </div>
                        }

                        @if (activeTab() === 'factures') {
                        <!-- Contenu Factures -->
                        <!-- Barre de recherche et filtre -->
                        <div class="flex flex-col sm:flex-row gap-4 mb-6">
                            <div class="flex-1 relative">
                                <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <input type="text" placeholder="Rechercher ici"
                                    class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent" />
                            </div>
                            <select
                                class="px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#ff5c01] focus:border-transparent bg-white">
                                <option value="all">Tous les status</option>
                                <option value="Actif">Actif</option>
                                <option value="Expiré">Expiré</option>
                            </select>
                        </div>
                        <div>
                            @if (isLoadingFactures()) {
                            <div class="flex justify-center py-12">
                                <svg class="animate-spin h-10 w-10 text-[#ff5c01]" fill="none"
                                    viewBox="0 0 24 24">...</svg>
                            </div>
                            } @else {
                            <div class="bg-gray-50 rounded-lg overflow-hidden">
                                <table class="w-full">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Référence</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Date</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Montant</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Plan</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Statut</th>
                                            <th
                                                class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                                                Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        @for (facture of factures(); track facture.id) {
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 text-sm font-medium text-gray-900">{{
                                                facture.invoiceNumber }}</td>
                                            <td class="px-6 py-4 text-sm text-gray-600">{{ formatDate(facture.createdAt)
                                                }}</td>
                                            <td class="px-6 py-4 text-sm font-medium text-gray-900">{{
                                                formatMontant(facture.amount) }}</td>
                                            <td class="px-6 py-4 text-sm text-gray-600">{{ facture.planLabel }}</td>
                                            <td class="px-6 py-4">
                                                @if (facture.paid) {
                                                <span
                                                    class="px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">Payée</span>
                                                } @else {
                                                <span
                                                    class="px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">En
                                                    attente</span>
                                                }
                                            </td>
                                            <td class="px-6 py-4 text-sm">
                                                @if (facture.paid) {
                                                <button (click)="telechargerFacturePDF(facture)"
                                                    class="inline-flex items-center gap-2 text-[#ff5c01] hover:text-[#e54f00] font-medium transition-colors duration-200">

                                                    <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                                        </path>
                                                    </svg>

                                                    
                                                </button>
                                                } @else {
                                                <button (click)="payerFacture(facture.id.toString())"
                                                    class="text-white bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium">
                                                    Payer maintenant
                                                </button>
                                                }
                                            </td>

                                        </tr>
                                        } @empty {
                                        <tr>
                                            <td colspan="6" class="text-center py-12 text-gray-500">Aucune facture
                                                trouvée</td>
                                        </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>

                            <!-- Pagination -->
                            <!-- ... inchangé ... -->
                            }
                        </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>