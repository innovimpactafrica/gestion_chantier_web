<div class="flex justify-between items-center mb-6">
  <h2 class="text-2xl font-bold text-gray-800">Les acteurs du chantier</h2>
  <button (click)="openAddMemberModal()"
    class="flex items-center px-5 py-2 bg-white border border-gray-300 rounded-full shadow-sm hover:bg-gray-50">
    <span class="mr-2 text-xl">+</span>
    <span>Ajouter un membre</span>
  </button>
</div>

<p class="mb-4">
  Cette section présente l'ensemble des acteurs impliqués dans le chantier,
  leurs rôles et leurs responsabilités.
</p>

<!-- Message d'erreur -->
<div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
  <p>{{ error }}</p>
  <button (click)="refresh()"
    class="mt-2 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500">
    Réessayer
  </button>
</div>

<div class="container mx-auto p-4">
  <!-- Tableau d'équipe -->

  <div class="bg-white rounded-lg shadow-lg overflow-hidden">
    <!-- En-tête du tableau -->
    <div class="grid grid-cols-6 gap-4 px-6 py-4 border-b">
      <div class="font-medium text-gray-800">Nom</div>
      <div class="font-medium text-gray-800">Rôles</div>
      <div class="font-medium text-gray-800">Téléphone</div>
      <div class="font-medium text-gray-800">Adresse</div>
      <div class="font-medium text-gray-800">Email</div>
      <div class="font-medium text-gray-800">Action</div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="px-6 py-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"></div>
      <p class="mt-2 text-gray-600">Chargement en cours...</p>
    </div>

    <!-- Lignes du tableau -->
    <div *ngIf="!isLoading" class="min-h-[400px]">
      <div *ngFor="let member of teamMembers"
        class="grid grid-cols-6 gap-4 px-6 py-4 border-b items-center hover:bg-gray-50 transition-colors">
        <div class="flex items-center">
          <div class="w-12 h-12 rounded-full overflow-hidden mr-3 bg-gray-200">
            <img [src]="member.avatar" [alt]="member.name" class="w-full h-full object-cover">
          </div>
          <span class="font-medium text-gray-900">{{ member.name }}</span>
        </div>
        <div class="text-gray-600">
          <span class="inline-block px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">
            {{ member.role }}
          </span>
        </div>
        <div class="text-gray-600">
          <a [href]="'tel:' + member.phone" class="hover:text-orange-600 hover:underline">
            {{ member.phone }}
          </a>
        </div>
        <div class="text-gray-600">{{ member.address }}</div>
        <div class="text-gray-600">
          <a [href]="'mailto:' + member.email" class="hover:text-orange-600 hover:underline">
            {{ member.email }}
          </a>
        </div>
        <div>
          <button class="p-8 transition-colors inline-flex items-center justify-center" [title]="'Voir ' + member.name"
            (click)="viewMember(member)">
            <svg width="24" height="26" viewBox="0 0 24 26" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M12.0003 7.6718C13.8089 7.66579 15.5825 8.17028 17.1172 9.12727C18.6518 10.0843 19.8853 11.4549 20.6757 13.0816C19.0528 16.3964 15.738 18.4915 12.0003 18.4915C8.26263 18.4915 4.94788 16.3964 3.32493 13.0816C4.11537 11.4549 5.34883 10.0843 6.8835 9.12727C8.41816 8.17028 10.1917 7.66579 12.0003 7.6718ZM12.0003 5.70459C7.0823 5.70459 2.8823 8.76361 1.18066 13.0816C2.8823 17.3997 7.0823 20.4587 12.0003 20.4587C16.9184 20.4587 21.1184 17.3997 22.82 13.0816C21.1184 8.76361 16.9184 5.70459 12.0003 5.70459ZM12.0003 10.6226C12.6525 10.6226 13.278 10.8817 13.7391 11.3429C14.2003 11.804 14.4594 12.4295 14.4594 13.0816C14.4594 13.7338 14.2003 14.3593 13.7391 14.8204C13.278 15.2816 12.6525 15.5407 12.0003 15.5407C11.3482 15.5407 10.7227 15.2816 10.2615 14.8204C9.80039 14.3593 9.54132 13.7338 9.54132 13.0816C9.54132 12.4295 9.80039 11.804 10.2615 11.3429C10.7227 10.8817 11.3482 10.6226 12.0003 10.6226ZM12.0003 8.65541C9.56099 8.65541 7.57411 10.6423 7.57411 13.0816C7.57411 15.521 9.56099 17.5079 12.0003 17.5079C14.4397 17.5079 16.4266 15.521 16.4266 13.0816C16.4266 10.6423 14.4397 8.65541 12.0003 8.65541Z"
                fill="#4B4848" />
            </svg>

          </button>
        </div>
      </div>

      <!-- Message si aucun membre -->
      <div *ngIf="teamMembers.length === 0 && !isLoading" class="px-6 py-8 text-center text-gray-500">
        <p>Aucun membre d'équipe trouvé.</p>
      </div>
    </div>

    <!-- Pagination -->
    <div class="px-6 py-4 flex items-center justify-between border-t bg-gray-50">
      <span class="text-sm text-gray-600">{{ getPaginationText() }}</span>
      <div class="flex space-x-2">
        <!-- Bouton précédent -->
        <button *ngIf="hasPreviousPage()" (click)="previousPage()"
          class="px-4 py-2 rounded-full hover:bg-gray-100 text-orange-500 flex items-center justify-center transition-colors">
          Précédent
        </button>

        <!-- Numéros de page -->
        <button *ngFor="let page of getPageNumbers()" (click)="goToPage(page)"
          [class]="page === currentPage ? 
            'w-10 h-10 rounded-full bg-orange-500 text-white flex items-center justify-center' : 
            'w-10 h-10 rounded-full hover:bg-gray-100 text-gray-500 flex items-center justify-center transition-colors'">
          {{ page }}
        </button>

        <!-- Bouton suivant -->
        <button *ngIf="hasNextPage()" (click)="nextPage()"
          class="px-4 py-2 rounded-full hover:bg-gray-100 text-orange-500 flex items-center justify-center transition-colors">
          Suivant
        </button>
      </div>
    </div>
  </div>

</div>

<!-- Modal d'ajout de membre -->
<div *ngIf="showAddMemberModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
  (click)="onBackdropClick($event)">

  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-6 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800">Ajouter un nouveau membre</h2>
      <button (click)="closeAddMemberModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="p-6 space-y-4">
      <!-- Messages d'erreur/succès -->
      <div *ngIf="submitError" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
        {{ submitError }}
      </div>

      <div *ngIf="submitSuccess" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded">
        {{ submitSuccess }}
      </div>

      <!-- Formulaire d'ajout -->
      <form (ngSubmit)="submitAddMember()" #addMemberForm="ngForm">
        <!-- Nom et Prénom -->
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label for="nom" class="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
            <input type="text" id="nom" [(ngModel)]="newMember.nom" name="nom" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Nom">
          </div>
          <div>
            <label for="prenom" class="block text-sm font-medium text-gray-700 mb-2">Prénom *</label>
            <input type="text" id="prenom" [(ngModel)]="newMember.prenom" name="prenom" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Prénom">
          </div>
        </div>

        <!-- Email et Téléphone -->
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
            <input type="email" id="email" [(ngModel)]="newMember.email" name="email" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="email@exemple.com">
          </div>
          <div>
            <label for="telephone" class="block text-sm font-medium text-gray-700 mb-2">Téléphone *</label>
            <input type="tel" id="telephone" [(ngModel)]="newMember.telephone" name="telephone" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="77 123 45 67">
          </div>
        </div>

        <!-- Date de naissance et Lieu de naissance -->
        <div class="grid grid-cols-2 gap-4 mb-4">
          <div>
            <label for="date" class="block text-sm font-medium text-gray-700 mb-2">Date de naissance *</label>
            <input type="date" id="date" [(ngModel)]="newMember.date" name="date" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent">
          </div>
          <div>
            <label for="lieunaissance" class="block text-sm font-medium text-gray-700 mb-2">Lieu de naissance *</label>
            <input type="text" id="lieunaissance" [(ngModel)]="newMember.lieunaissance" name="lieunaissance" required
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Ville de naissance">
          </div>
        </div>

        <!-- Adresse -->
        <div class="mb-4">
          <label for="adress" class="block text-sm font-medium text-gray-700 mb-2">Adresse *</label>
          <input type="text" id="adress" [(ngModel)]="newMember.adress" name="adress" required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
            placeholder="Adresse complète">
        </div>

        <!-- Mot de passe -->
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Mot de passe *</label>
          <input type="password" id="password" [(ngModel)]="newMember.password" name="password" required minlength="6"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
            placeholder="Mot de passe (minimum 6 caractères)">
        </div>

        <!-- Actions du formulaire -->
        <div class="flex justify-end gap-3 pt-4 border-t">
          <button type="button" (click)="closeAddMemberModal()"
            class="px-6 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
            Annuler
          </button>
          <button type="submit" [disabled]="isSubmitting"
            class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            <span *ngIf="isSubmitting" class="flex items-center gap-2">
              <svg class="animate-spin w-4 h-4" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
              </svg>
              Ajout...
            </span>
            <span *ngIf="!isSubmitting">Ajouter</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de visualisation du membre -->

<div *ngIf="showViewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
  (click)="onViewBackdropClick($event)">

  <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
    <!-- Modal Header -->
    <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Détails</h2>
      <button (click)="closeViewModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="p-6" *ngIf="selectedMember">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Colonne gauche - Informations principales -->
        <div class="space-y-4">
          <!-- Profil -->
          <div class="flex items-center gap-4 p-4 border border-gray-200 rounded-lg">
            <div class="w-14 h-14 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
              <img [src]="selectedMember.avatar" [alt]="selectedMember.name" class="w-full h-full object-cover">
            </div>
            <div class="flex-1">
              <h3 class="text-base font-semibold text-gray-900">{{ selectedMember.name }}</h3>
              <p class="text-sm text-gray-600">{{ selectedMember.role }}</p>
            </div>
            <div class="flex gap-2">
              <button class="w-10 h-10 rounded-full border border-gray-300 hover:bg-gray-50 flex items-center justify-center transition-colors">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                  </path>
                </svg>
              </button>
              <button class="w-10 h-10 rounded-full border border-gray-300 hover:bg-gray-50 flex items-center justify-center transition-colors">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                  </path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Statistiques en grille 2x2 -->
          <div class="grid grid-cols-2 gap-4">
            <!-- Jours présents -->
            <div class="p-4 rounded-lg border border-gray-200 bg-white">
              <p class="text-xs text-gray-600 mb-1">Jours présents</p>
              <div class="flex items-end justify-between">
                <p class="text-3xl font-bold text-gray-900">{{ selectedMember.daysPresent }}</p>
                <div class="w-10 h-10 rounded-lg bg-orange-50 flex items-center justify-center flex-shrink-0">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 1.5V0M15.7785 2.2035L16.3185 0.804M17.8335 3.2685L18.4605 3.723M20.5845 5.9535L21.8115 5.0895M21.7005 7.9815L23.394 8.2365M22.4955 11.742L23.997 11.7045M22.299 14.049L23.565 15.201M20.871 17.6175L22.138 18.42M19.425 19.425L20.4855 20.4855" stroke="#F5A623" stroke-width="1.5"/>
                    <path d="M12 1.5C6.201 1.5 1.5 6.201 1.5 12C1.5 17.799 6.201 22.5 12 22.5C17.799 22.5 22.5 17.799 22.5 12" stroke="#F5A623" stroke-width="1.5"/>
                    <path d="M11.25 4.5C11.25 4.30109 11.329 4.11032 11.4697 3.96967C11.6103 3.82902 11.8011 3.75 12 3.75C12.1989 3.75 12.3897 3.82902 12.5303 3.96967C12.671 4.11032 12.75 4.30109 12.75 4.5V13.5L16.872 15.849C17.0397 15.9502 17.1612 16.1129 17.2104 16.3024C17.2597 16.492 17.2329 16.6933 17.1358 16.8633C17.0386 17.0333 16.8788 17.1586 16.6905 17.2124C16.5022 17.2661 16.3003 17.2441 16.128 17.151L11.25 14.628V4.5Z" fill="#F5A623"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Heures travaillées -->
            <div class="p-4 rounded-lg border border-gray-200 bg-white">
              <p class="text-xs text-gray-600 mb-1">Heures travaillées</p>
              <div class="flex items-end justify-between">
                <p class="text-3xl font-bold text-gray-900">{{ selectedMember.hoursWorked }}</p>
                <div class="w-10 h-10 rounded-lg bg-blue-50 flex items-center justify-center flex-shrink-0">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6.825 21.75H17.175C18.103 21.75 18.841 20.986 18.741 20.107C18.096 14.438 14.25 14.531 14.25 12C14.25 9.469 18.146 9.609 18.74 3.893C18.834 3.013 18.102 2.25 17.174 2.25H6.825C5.897 2.25 5.167 3.013 5.259 3.893C5.854 9.609 9.75 9.422 9.75 12C9.75 14.578 5.903 14.438 5.259 20.107C5.159 20.986 5.897 21.75 6.825 21.75Z" stroke="#4C6EF5" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M16.092 20.25H7.928C7.197 20.25 6.991 19.406 7.504 18.883C8.745 17.625 11.25 16.724 11.25 15.281V10.5C11.25 9.57 9.469 8.859 8.367 7.35C8.185 7.101 8.203 6.75 8.666 6.75H15.356C15.75 6.75 15.836 7.098 15.656 7.348C14.57 8.859 12.75 9.565 12.75 10.5V15.281C12.75 16.712 15.362 17.484 16.519 18.884C16.985 19.449 16.822 20.25 16.092 20.25Z" fill="#4C6EF5"/>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Tâches terminées -->
            <div class="p-4 rounded-lg border border-gray-200 bg-white">
              <p class="text-xs text-gray-600 mb-1">Tâches terminées</p>
              <div class="flex items-end justify-between">
                <p class="text-3xl font-bold text-gray-900">{{ selectedMember.tasksCompleted }}</p>
                <div class="w-10 h-10 rounded-lg bg-green-50 flex items-center justify-center flex-shrink-0">
                  <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Performance -->
            <div class="p-4 rounded-lg border border-gray-200 bg-white">
              <p class="text-xs text-gray-600 mb-1">Performance</p>
              <div class="flex items-end justify-between">
                <p class="text-3xl font-bold text-gray-900">{{ selectedMember.performance }}%</p>
                <div class="w-10 h-10 rounded-lg bg-pink-50 flex items-center justify-center flex-shrink-0">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22.875 5.25V11.25C22.875 11.548 22.756 11.834 22.545 12.045C22.334 12.256 22.048 12.375 21.75 12.375C21.452 12.375 21.165 12.256 20.954 12.045C20.744 11.834 20.625 11.548 20.625 11.25V7.969L13.546 15.049C13.337 15.257 13.056 15.374 12.763 15.374C12.47 15.374 12.189 15.257 11.98 15.049L9.028 12.094L3.074 18.046C2.863 18.257 2.576 18.376 2.277 18.376C1.978 18.376 1.691 18.257 1.48 18.046C1.269 17.835 1.15 17.548 1.15 17.249C1.15 16.95 1.269 16.664 1.48 16.452L8.23 9.702C8.439 9.494 8.72 9.377 9.013 9.377C9.306 9.377 9.587 9.494 9.796 9.702L12.75 12.656L19.031 6.375H15.75C15.452 6.375 15.165 6.256 14.954 6.045C14.744 5.834 14.625 5.548 14.625 5.25C14.625 4.952 14.744 4.665 14.954 4.454C15.165 4.244 15.452 4.125 15.75 4.125H21.75C22.048 4.125 22.334 4.244 22.545 4.454C22.756 4.665 22.875 4.952 22.875 5.25Z" fill="#EF4444"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>

          <!-- Répartition des tâches -->
          <div class="border border-gray-200 rounded-lg p-4 bg-white">
            <h4 class="text-sm font-semibold text-gray-900 mb-4">Répartition des tâches (%)</h4>
            <div class="flex items-center gap-8">
              <!-- Donut Chart -->
              <div class="relative w-32 h-32 flex-shrink-0">
                <svg class="w-full h-full transform -rotate-90">
                  <circle cx="64" cy="64" r="52" fill="none" stroke="#e5e7eb" stroke-width="24"></circle>
                  <!-- Terminées (50%) - vert -->
                  <circle cx="64" cy="64" r="52" fill="none" stroke="#22c55e" stroke-width="24"
                    [attr.stroke-dasharray]="164 * 0.50 + ' 328'" stroke-dashoffset="0"></circle>
                  <!-- En Cours (28.9%) - orange -->
                  <circle cx="64" cy="64" r="52" fill="none" stroke="#f97316" stroke-width="24"
                    [attr.stroke-dasharray]="164 * 0.289 + ' 328'" [attr.stroke-dashoffset]="-164 * 0.50"></circle>
                  <!-- À Faire (15.8%) - jaune clair -->
                  <circle cx="64" cy="64" r="52" fill="none" stroke="#e5e7eb" stroke-width="24"
                    [attr.stroke-dasharray]="164 * 0.158 + ' 328'" [attr.stroke-dashoffset]="-164 * 0.789"></circle>
                  <!-- En Retard (5.3%) - rouge -->
                  <circle cx="64" cy="64" r="52" fill="none" stroke="#ef4444" stroke-width="24"
                    [attr.stroke-dasharray]="164 * 0.053 + ' 328'" [attr.stroke-dashoffset]="-164 * 0.947"></circle>
                </svg>
              </div>
              <!-- Légende -->
              <div class="space-y-2 flex-1">
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-gray-200"></div>
                    <span class="text-gray-700">À Faire</span>
                  </div>
                  <span class="font-semibold text-gray-900">{{ selectedMember.taskDistribution?.['À Faire'] || 15.8 }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-orange-500"></div>
                    <span class="text-gray-700">En cours</span>
                  </div>
                  <span class="font-semibold text-gray-900">{{ selectedMember.taskDistribution?.['En Cours'] || 28.9 }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <span class="text-gray-700">Terminés</span>
                  </div>
                  <span class="font-semibold text-gray-900">{{ selectedMember.taskDistribution?.['Terminées'] || 50 }}%</span>
                </div>
                <div class="flex items-center justify-between text-sm">
                  <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <span class="text-gray-700">En retard</span>
                  </div>
                  <span class="font-semibold text-gray-900">{{ selectedMember.taskDistribution?.['En Retard'] || 5.3 }}%</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Colonne droite - Historique des présences -->
        <div class="space-y-4">
          <div class="flex items-center justify-between mb-2">
            <h4 class="text-sm font-semibold text-gray-900">Historique des présences</h4>
            <div class="relative">
              <button (click)="toggleDatePicker()" class="text-sm text-gray-700 hover:text-gray-900 flex items-center gap-1.5 px-3 py-1.5 rounded border border-gray-300 hover:bg-gray-50 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                Filtrer par date
              </button>

              <!-- Date Picker Popup -->
              <div *ngIf="showDatePicker" class="absolute right-0 top-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 p-4 z-50 w-80">
                <div class="flex items-center justify-between mb-4">
                  <button (click)="previousMonth()" class="p-1 hover:bg-gray-100 rounded transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                  </button>
                  <span class="font-semibold text-gray-900">{{ currentMonthYear }}</span>
                  <button (click)="nextMonth()" class="p-1 hover:bg-gray-100 rounded transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                  </button>
                </div>
                <div class="grid grid-cols-7 gap-1">
                  <div class="text-center text-xs font-medium text-gray-600 py-2" *ngFor="let day of ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim']">{{ day }}</div>
                  <!-- Empty cells for alignment -->
                  <div *ngFor="let empty of getEmptyDays()" class="text-center text-sm py-2"></div>
                  <!-- Calendar days -->
                  <div *ngFor="let day of getCalendarDays()" 
                       (click)="selectDate(day)"
                       [class]="getDayClasses(day)"
                       class="text-center text-sm py-2 hover:bg-gray-100 rounded cursor-pointer transition-colors">
                    {{ day }}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Historique des présences -->
          <div class="space-y-4 max-h-[500px] overflow-y-auto pr-2" *ngIf="selectedMember.presenceHistory && selectedMember.presenceHistory.length > 0">
            <div *ngFor="let day of getFilteredPresenceHistory()" class="border-l-4 border-orange-500 pl-4 pb-4">
              <div class="flex items-center justify-between mb-3">
                <span class="text-sm font-semibold text-gray-900">{{ day.date }}</span>
                <span class="text-sm text-gray-600">Total: {{ day.totalTime }}</span>
              </div>

              <div *ngFor="let session of day.sessions" class="bg-white border border-gray-200 rounded-lg p-3 mb-2">
                <div class="flex items-center gap-3 mb-2">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.5" d="M6.5625 12.5625C8.1538 12.5625 9.67992 11.9304 10.8051 10.8051C11.9304 9.67992 12.5625 8.1538 12.5625 6.5625C12.5625 4.9712 11.9304 3.44508 10.8051 2.31986C9.67992 1.19464 8.1538 0.5625 6.5625 0.5625" stroke="#1EA438" stroke-width="1.125" stroke-linecap="round"/>
                    <path d="M0.5625 6.5625H8.0625M8.0625 6.5625L5.8125 4.3125M8.0625 6.5625L5.8125 8.8125" stroke="#1EA438" stroke-width="1.125" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <div class="flex-1">
                    <span class="text-sm text-gray-600">Entrée:</span>
                    <span class="text-sm font-semibold text-gray-900 ml-1">{{ session.entry }}</span>
                  </div>
                  <span class="text-xs px-2.5 py-0.5 bg-green-100 text-green-700 rounded-full font-medium">Présent</span>
                </div>
                <div class="flex items-center gap-3">
                  <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path opacity="0.5" d="M6.5625 0.5625C4.9712 0.5625 3.44508 1.19464 2.31986 2.31986C1.19464 3.44508 0.5625 4.9712 0.5625 6.5625C0.5625 8.1538 1.19464 9.67992 2.31986 10.8051C3.44508 11.9304 4.9712 12.5625 6.5625 12.5625" stroke="#FF5C02" stroke-width="1.125" stroke-linecap="round"/>
                    <path d="M12.5625 6.5625L5.0625 6.5625M5.0625 6.5625L7.3125 8.8125M5.0625 6.5625L7.3125 4.3125" stroke="#FF5C02" stroke-width="1.125" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <div class="flex-1">
                    <span class="text-sm text-gray-600">Sortie:</span>
                    <span class="text-sm font-semibold text-gray-900 ml-1">{{ session.exit }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Message si pas d'historique -->
          <div *ngIf="!selectedMember.presenceHistory || selectedMember.presenceHistory.length === 0" class="text-center py-12 text-gray-500">
            <svg class="w-12 h-12 mx-auto mb-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="text-sm">Aucun historique de présence disponible</p>
          </div>

          <!-- Total heures travaillées -->
          <div class="bg-gray-50 border border-gray-200 p-4 rounded-lg">
            <div class="flex items-center justify-between">
              <span class="text-sm font-semibold text-gray-900">Total Heures travaillées</span>
              <span class="text-xl font-bold text-gray-900">{{ getTotalWorkedTime() }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-start pt-6 border-t mt-6">
        <button type="button" (click)="closeViewModal()"
          class="px-6 py-2.5 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>